!function i(s,u,a){function c(e,t){if(!u[e]){if(!s[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(l)return l(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=u[e]={exports:{}};s[e][0].call(r.exports,function(t){return c(s[e][1][t]||t)},r,r.exports,i,s,u,a)}return u[e].exports}for(var l="function"==typeof require&&require,t=0;t<a.length;t++)c(a[t]);return c}({1:[function(t,e,o){"use strict";var n=angular.module("stemAppPanel",["ng-sortable","ui.router"]);n.controller("BaseController",t("./controllers/BaseController")),n.provider("ApiRequest",t("./providers/ApiRequestProvider")),n.directive("popupModal",t("./directives/PopupModalDirective")),n.service("CredentialsService",t("./services/CredentialsService")),n.service("FormBuilderService",t("./services/FormBuilderService")),n.service("AuthService",t("./services/AuthService")),n.service("VoteService",t("./services/VoteService")),n.filter("strLimit",t("./filters/StrLimitFilter")),n.component("landingComponent",t("./components/LandingComponent")),n.component("voteListComponent",t("./components/VoteListComponent")),n.component("voteCreateComponent",t("./components/VoteCreateComponent")),n.component("voteViewComponent",t("./components/VoteViewComponent")),n.component("voteEditComponent",t("./components/VoteEditComponent")),n.config(t("./router/routes.js")),n.config(["ApiRequestProvider",function(t){t.setHost(env.apiUrl)}]),angular.bootstrap(document.getElementById("StemAppPanel"),["stemAppPanel"]),env.html5Mode.enable||document.location.hash||(document.location.hash="#!/")},{"./components/LandingComponent":2,"./components/VoteCreateComponent":3,"./components/VoteEditComponent":4,"./components/VoteListComponent":5,"./components/VoteViewComponent":6,"./controllers/BaseController":7,"./directives/PopupModalDirective":8,"./filters/StrLimitFilter":9,"./providers/ApiRequestProvider":10,"./router/routes.js":11,"./services/AuthService":12,"./services/CredentialsService":13,"./services/FormBuilderService":14,"./services/VoteService":15}],2:[function(t,e,o){"use strict";e.exports={templateUrl:"./assets/templates/pages/landing.html",controller:["$rootScope","$scope","$state","CredentialsService",function(t,e,o,n){n.get()&&o.go("votes")}]}},{}],3:[function(t,e,o){"use strict";e.exports={templateUrl:"./assets/templates/pages/vote-create.html",controller:["$rootScope","$scope","$state","VoteService","FormBuilderService",function(t,e,o,n,r){var i=this;i.newOptionValue="",i.form=r.build({options:[],title:"",description:""}),i.onSubmit=function(){i.form.isLocked()||(i.form.lock(),n.store(i.form.values).then(function(){i.form.resetErrors(),o.go("votes"),i.form.unlock()},function(t){i.form.errors=t.data,i.form.unlock()}))},i.addOption=function(t){t.preventDefault(),t.stopPropagation(),i.form.values.options.push({value:i.newOptionValue}),i.newOptionValue="",i.updateOptionOrders()},i.destroyOption=function(t,e){t.preventDefault(),t.stopPropagation(),i.form.values.options.splice(i.form.values.options.indexOf(e),1)},i.updateOptionOrders=function(t){i.form.values.options=i.form.values.options.map(function(t,e){return t.order=e,t})},i.sortable={sort:!0,animation:150,handle:".handle",draggable:".list-option-item",group:"options",onUpdate:i.updateOptionOrders}}]}},{}],4:[function(t,e,o){"use strict";e.exports={templateUrl:"./assets/templates/pages/vote-edit.html",controller:["$rootScope","$scope","$state","$stateParams","FormBuilderService","VoteService",function(t,e,o,n,r,i){if(!n.id)return o.go("votes");var s=this;i.read(n.id).then(function(t){s.initForm(t.data)},function(t){console.error(t),alert("Something went wrong!")}),s.newOptionValue="",s.initForm=function(t){s.form=r.build(t)},s.onSubmit=function(){s.form.isLocked()||(s.form.lock(),i.update(s.form.values.id,s.form.values).then(function(){s.form.resetErrors(),o.go("votes"),s.form.unlock()},function(t){s.form.errors=t.data,s.form.unlock()}))},s.addOption=function(t){t.preventDefault(),t.stopPropagation(),s.form.values.options.push({value:s.newOptionValue}),s.newOptionValue="",s.updateOptionOrders()},s.destroyOption=function(t,e){t.preventDefault(),t.stopPropagation(),s.form.values.options.splice(s.form.values.options.indexOf(e),1)},s.updateOptionOrders=function(){s.form.values.options=s.form.values.options.map(function(t,e){return t.order=e,t})},s.sortable={sort:!0,animation:150,handle:".handle",draggable:".list-option-item",group:"options",onUpdate:s.updateOptionOrders}}]}},{}],5:[function(t,e,o){"use strict";e.exports={templateUrl:"./assets/templates/pages/vote-list.html",controller:["$rootScope","$scope","$state","$filter","VoteService",function(t,e,o,n,r){var i=this;i.loadList=function(){r.list().then(function(t){i.votes=t.data.map(function(t){return t.description=n("strLimit")(t.description,64),t.title=n("strLimit")(t.title,16),t})})},i.voteActivate=function(t){r.activate(t.id).then(function(t){i.loadList()},function(t){console.error(t),alert("Something went wrong!")})},i.voteDestroy=function(t){r.destroy(t.id).then(function(t){i.loadList()},function(t){alert("Something went wrong!")})},i.loadList()}]}},{}],6:[function(t,e,o){"use strict";e.exports={templateUrl:"./assets/templates/pages/vote-view.html",controller:["$rootScope","$scope","$state","$stateParams","VoteService",function(t,e,o,n,r){var i=this,s={0:"rgb(255, 99, 132)",1:"rgb(255, 159, 64)",2:"rgb(255, 205, 86)",3:"rgb(75, 192, 192)",4:"rgb(54, 162, 235)",5:"rgb(153, 102, 255)",6:"rgb(201, 203, 207)"};if(!n.id)return o.go("votes");r.read(n.id).then(function(t){i.initChart(t.data)},function(t){console.error(t),alert("Something went wrong!")}),i.initChart=function(t){var e=t.options.map(function(t){return t.responses}),o=t.options.map(function(t){return t.value}),n=e.reduce(function(t,e){return t+e});i.vote=t,i.countResponses=n;var r={type:"pie",data:{datasets:[{data:e,backgroundColor:Object.values(s).splice(0,e.length),label:"Dataset 1"}],labels:o},options:{responsive:!0}};document.getElementById("myChart")&&new Chart(document.getElementById("myChart").getContext("2d"),r)}}]}},{}],7:[function(t,e,o){"use strict";e.exports=["$scope","$state","$rootScope","AuthService","FormBuilderService","CredentialsService",function(o,n,r,i,t,s){r.$state=o.$state=n,o.locations=[],o.forms={},o.forms.login=t.build(),o.forms.voucher=t.build(),r.credentials=s.get(),r.auth={step:1};r.auth.signOut=function(t){t&&(t.stopPropagation(),t.preventDefault()),i.signOut(),r.credentials=s.get(),n.go("landing")},r.auth.signIn=function(t){t&&(t.stopPropagation(),t.preventDefault()),o.forms.login.reset();var e=function e(o){i.getIntentCodeState(o).then(function(t){"authorized"==t.data.state?i.intentToAccessToken(o).then(function(t){r.auth.step=r.auth.step+2,s.set(t.data.access_token),r.credentials=s.get(),r.$broadcast("voucher:fetch"),setTimeout(function(){$("[progress]")[0]&&new ProgressBar.Circle($("[progress]")[0],{color:"#FFEA82",trailColor:"#eee",trailWidth:1,duration:1400,easing:"bounce",strokeWidth:5,from:{color:"#70c567",a:0},to:{color:"#70c567",a:1},step:function(t,e){e.path.setAttribute("stroke",t.color)}}).set(1)},200),setTimeout(function(){r.auth.closeModals(),r.auth.step=1,n.go("votes")},2e3)}):"declined"==t.data.state?r.auth.closeModals():"pending"==t.data.state&&setTimeout(function(){e(o)},2e3)})};i.getIntentCode().then(function(t){$("#auth_qr").text(""),new QRCode("auth_qr").makeCode(t.data.token),setTimeout(function(){e(t.data.token)},2e3)}),$("body").addClass("popup-open"),$(".popups .popup").hide(),$(".popups .popup-forus-auth").show()},r.auth.signInSubmit=function(t,e){t&&(t.stopPropagation(),t.preventDefault()),e.submit||(e.submit=!0,i.sendSignInToken(e.values.email).then(function(t){r.auth.closeModals(),e.submit=!1,r.modals.push({icon:["mdi-checkbox-multiple-marked-circle-outline"],descLg:"Er is een E-mail verstuurd naar "+o.forms.login.values.email+". Druk op de login-knop in de mail om verder te gaan."}),e.reset()},function(t){e.errors=t.data,e.submit=!1}))},r.auth.closeModals=function(t){t&&(t.stopPropagation(),t.preventDefault()),$("body").removeClass("popup-open"),$(".popup").hide()},window.modals=r.modals=new function(){var o=[];this.count=function(){return o.length},this.push=function(e){e.close=function(t){t&&(t.stopPropagation(),t.preventDefault()),o.splice(o.indexOf(e),1)},o.push(e)},this.modals=function(){return o}}}]},{}],8:[function(t,e,o){"use strict";e.exports=[function(){return{restrict:"A",templateUrl:"./assets/templates/directives/popup-modal.html",replace:!0,transclude:!0,scope:{modal:"="},link:function(t,e,o,n){}}}]},{}],9:[function(t,e,o){"use strict";e.exports=function(){return function(t,e){var o="";return"string"!=typeof t?"":(t.length>e&&(o+="..."),t.substring(0,e)+o)}}},{}],10:[function(t,e,o){"use strict";e.exports=function(){return new function(){var l=!1;this.setHost=function(t){for(;"/"==t[t.length-1];)t=t.slice(0,t.length-1);l=t},this.$get=["$q","$http","$state","$rootScope","CredentialsService",function(s,u,a,t,c){var n=function(t,e,o,n,r){var i={};return i.data=o||{},i.headers=Object.assign(function(){c.get();return{Accept:"application/json","Content-Type":"application/json","Access-Token":c.get()}}(),n||{}),i.url=function(t){var e=document.createElement("a");e.href=t;var o=e.pathname.split("/");return""!==o[0]&&o.unshift(""),e.protocol+"//"+e.host+o.join("/")}(l+e),i.method=t,s(function(e,o){u(i).then(function(t){e(t)},function(t){401==t.status&&a.go("logout"),o(t)})})};return{get:function(t,e,o){return n("GET",t,e,o)},put:function(t,e,o){return n("PUT",t,e,o)},post:function(t,e,o){return n("POST",t,e,o)},delete:function(t,e,o){return n("DELETE",t,e,o)},ajax:n}}]}}},{}],11:[function(t,e,o){"use strict";e.exports=["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,o){env.html5Mode.enable&&o.html5Mode(!0),t.state({url:"/logout",name:"logout",controller:["$state","$rootScope","CredentialsService",function(t,e,o){o.set(null),e.credentials=o.get(),t.go("landing")}]}).state({url:"/",name:"landing",component:"landingComponent",data:{title:"Home"}}).state({url:"/votes",name:"votes",component:"voteListComponent",data:{title:"Vote list"}}).state({url:"/votes/create",name:"vote-create",component:"voteCreateComponent",data:{title:"Vote create"}}).state({url:"/votes/:id/edit",name:"vote-edit",component:"voteEditComponent",data:{title:"Vote edit"}}).state({url:"/votes/:id",name:"vote-view",component:"voteViewComponent",data:{title:"Vote view"}})}]},{}],12:[function(t,e,o){"use strict";e.exports=["ApiRequest","CredentialsService",function(e,o){return new function(){this.signOut=function(t){o.set(null)},this.getUser=function(){return e.get("/user")},this.getVoucher=function(){return e.get("/user/voucher")},this.getQrCode=function(){return e.get("/user/voucher/qr-code")},this.getIntentCode=function(){return e.get("/auth/token")},this.getIntentCodeState=function(t){return e.post("/auth/token/check",{token:t})},this.intentToAccessToken=function(t){return e.post("/auth/token/exchange",{token:t})}}}]},{}],13:[function(t,e,o){"use strict";e.exports=[function(){return new function(){this.set=function(t){return localStorage.setItem("access_token",JSON.stringify(t))},this.get=function(){return JSON.parse(localStorage.getItem("access_token"))}}}]},{}],14:[function(t,e,o){"use strict";e.exports=["$http",function(t){return new function(){this.build=function(t,e){return{locked:!1,values:t||{},errors:e||{},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},isLocked:function(){return this.locked},resetValues:function(){return this.values={}},resetErrors:function(){return this.errors={}},reset:function(){return this.resetValues()&this.resetErrors()}}}}}]},{}],15:[function(t,e,o){"use strict";e.exports=["ApiRequest",function(o){return new function(){this.list=function(){return o.get("/votes")},this.read=function(t){return o.get("/votes/"+t)},this.store=function(t){return o.post("/votes",t)},this.update=function(t,e){return o.put("/votes/"+t,e)},this.destroy=function(t){return o.delete("/votes/"+t)},this.activate=function(t){return o.post("/votes/"+t+"/activate")}}}]},{}],16:[function(t,e,o){},{}]},{},[16,1]);
//# sourceMappingURL=app.js.map
